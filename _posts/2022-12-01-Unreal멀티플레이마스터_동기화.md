---
title: "언리얼 멀티플레이 동기화"
permalink: /posts/Unreal/
excerpt: "언리얼 멀티플레이 동기화"
last_modified_at: 2022-12-01T09:40:00-04:00
toc: true
---

# 코드 실행 위치 감지하기
## Moving Platform 추가하기
- StaticMeshActor를 상속받아 MovingPlatform클래스 생성
	- MovingPlatform.h
		``` C++
		#pragma once

		#include "CoreMinimal.h"
		#include "Engine/StaticMeshActor.h"
		#include "MovingPlatform.generated.h"
		UCLASS()
		class PUZZLEPLATFORMS_API AMovingPlatform : public AStaticMeshActor
		{
			GENERATED_BODY()
		public:
			AMovingPlatform();
			virtual void Tick(float DeltaTime) override;
		};
		```
	- MovingPlatform.cpp
		``` C++
		#include "MovingPlatform.h"
		
		AMovingPlatform::AMovingPlatform() {
			PrimaryActorTick.bCanEverTick = true;
		
			SetMobility(EComponentMobility::Movable);
		}

		void AMovingPlatform::Tick(float DeltaTime)
		{
			Super::Tick(DeltaTime);
			FVector Location = GetActorLocation();
			Location += FVector(5 * DeltaTime, 0, 0);
			SetActorLocation(Location);
		}
		```
		- SetMobility를 Movable로 지정해야 움직일 수 있음
- MovingPlatform을 씬에 드래그앤드롭하고 플레이하면 조금씩 움직이는 MovingPlatform확인 가능

 
## 만약 아래와 같은 컴파일 에러가 발생한다면?
- ![화면 캡처 2022-12-01 094835](https://user-images.githubusercontent.com/11372675/204940350-01051883-24cd-49fc-b085-e8270057da18.png)
- live coding설정이 활성화되어있기에 Visual Studio에서 Build를 하는 것이 아니라 UnrealProject에서 컴파일을 해야함
	- ![image](https://user-images.githubusercontent.com/11372675/204940945-1c50513e-2570-4a3d-a099-163718f4569c.png)
	- 오른쪽 하단에서 위와 같은 버튼을 찾아 클릭하자

## 내가 서버인가? 클라이언트인가?
- Actor를 상속받은 객체는 HasAuthority()라는 함수를 호출 가능
	- 반환값이 true라면 서버, false라면 client를 의미한다.

- MovingPlatform을 서버에서만 움직일 수 있도록 하자
	- MovingPlatform.h
		``` c++
		UPROPERTY(EditAnywhere)
		float Speed = 20;
		```
	- MovingPlatform.cpp
		``` c++
		void AMovingPlatform::Tick(float DeltaTime)
		{
			Super::Tick(DeltaTime);
			if (HasAuthority()) 
			{
				FVector Location = GetActorLocation();
				Location += FVector(Speed * DeltaTime, 0, 0);
				SetActorLocation(Location);
			}
		}
		```
	- 컴파일 후 실행해보면 클라이언트에서는 MovingPlatform이 움직이지 않음
		- 서버에서만 동작하고있고, 그것을 동기화해주겠다는 설정을 안 해주었기 때문
